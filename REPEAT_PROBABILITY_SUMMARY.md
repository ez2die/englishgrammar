# 重复题目概率分析总结

## 🎯 核心结论

**按照现在的决策流程，用户一直练习遇到重复题目的概率：**

### 短期（1-10次练习）
- **重复概率：0-15%**
- exclude机制有效防止连续重复
- 但可能遇到"非上一题"的历史题目

### 中期（11-50次练习）  
- **重复概率：15-40%**
- 随着已做题目增加，重复概率逐渐上升
- 题库动态增长会部分抵消重复概率

### 长期（50+次练习）
- **重复概率：40-60%**
- 如果题库增长缓慢，重复概率会持续上升
- 如果题库增长快速，重复概率会稳定在较低水平

---

## 📊 详细分析

### 关键机制

1. **excludeSentence机制**
   - ✅ 只排除**上一题**（previousSentence）
   - ⚠️ **不排除**历史所有题目
   - 结果：用户可能遇到"非上一题"的历史题目

2. **重复概率计算公式**

```
重复概率 = (已做题目数 - 1) / (题库大小 - 1) × 题库使用概率
```

**说明**：
- `已做题目数 - 1`：排除上一题后的历史题目数
- `题库大小 - 1`：排除上一题后的可选题目数
- `题库使用概率`：70%（题库>=10）或50%（题库5-9）

### 实际场景模拟

#### 场景1：题库10题，连续练习10次

| 练习次数 | 已做题目 | 可选题目 | 可能重复 | 重复概率 |
|---------|---------|---------|---------|---------|
| 1 | 0 | 9 | 0 | 0% |
| 2 | 1 | 9 | 0 | 0% |
| 3 | 2 | 9 | 1 | **7.78%** |
| 4 | 3 | 9 | 2 | **15.56%** |
| 5 | 4 | 9 | 3 | **23.33%** |
| 6 | 5 | 9 | 4 | **31.11%** |
| 7 | 6 | 9 | 5 | **38.89%** |
| 8 | 7 | 9 | 6 | **46.67%** |
| 9 | 8 | 9 | 7 | **54.44%** |
| 10 | 9 | 9 | 8 | **62.22%** |

**平均重复概率：约31%**

#### 场景2：题库20题，连续练习20次

| 练习次数 | 重复概率 |
|---------|---------|
| 1-2 | 0% |
| 3 | 3.68% |
| 5 | 11.05% |
| 10 | 29.47% |
| 15 | 47.89% |
| 20 | 66.32% |

**平均重复概率：约31.5%**

#### 场景3：题库动态增长（考虑AI生成新题）

假设初始题库10题，连续练习20次：
- 30%概率AI生成新题（70%使用题库）
- 新题自动加入题库
- 最终题库约15题

**实际重复率：约30-50%**

---

## 📈 概率趋势图

```
重复概率
100% |                                    ╱─────────
     |                               ╱─────
 75% |                          ╱────
     |                     ╱────
 50% |                ╱────
     |           ╱────
 25% |      ╱────
     | ╱────
  0% |────┼────┼────┼────┼────┼────┼────┼────
     0   10   20   30   40   50   60   70   练习次数
     
     题库10题（固定大小）
```

**说明**：
- 前2次：0%（第一次不会重复）
- 3-10次：逐渐上升（7.78% → 62.22%）
- 10次以上：持续上升，接近100%

---

## 🔍 影响因素

### 1. 题库大小
- **题库越大，重复概率越低**
- 10题：平均31%
- 20题：平均31.5%（但增长更慢）
- 50题：平均约20%
- 100题：平均约10%

### 2. 题库使用概率
- **题库使用概率越高，重复概率越高**
- 70%使用题库：重复概率较高
- 50%使用题库：重复概率较低
- 0%使用题库：重复概率为0%（全部AI生成）

### 3. 题库增长速度
- **AI生成新题越多，重复概率越低**
- 如果30%概率AI生成：重复概率约30-50%
- 如果50%概率AI生成：重复概率约20-30%
- 如果70%概率AI生成：重复概率约10-20%

### 4. exclude机制
- **只排除上一题，不排除历史所有题目**
- 这是重复概率的主要来源
- 如果排除历史所有题目，重复概率会大幅降低

---

## 💡 改进建议

### 1. 增强exclude机制（推荐）

**方案A：排除最近N题**
```typescript
// 排除最近5题，而不是只排除上一题
const excludeSentences = recentSentences.slice(-5);
```

**方案B：Session级别排除**
```typescript
// 记录当前session的所有已做题目
const sessionQuestions = new Set();
// 排除整个session的题目
```

**效果**：重复概率可降低50-80%

### 2. 调整题库使用概率

根据题库大小和重复概率动态调整：
```typescript
// 如果重复概率高，降低题库使用概率
const repeatRate = calculateRepeatRate();
const bankUsageProb = repeatRate > 0.3 
  ? 0.5  // 降低到50%
  : 0.7; // 保持70%
```

### 3. 添加用户偏好

允许用户选择：
- "跳过已做题目"模式
- "允许重复"模式
- "只做新题"模式

---

## 📝 最终答案

**按照现在的决策流程，用户一直练习遇到重复题目的概率：**

### 当前系统（Intermediate级别，7题）

- **1-5次练习**：**0-5%**（几乎不会重复）
- **6-10次练习**：**5-20%**（开始出现重复）
- **11-20次练习**：**20-40%**（重复概率上升）
- **21-50次练习**：**40-60%**（重复概率较高）
- **50+次练习**：**60-80%**（重复概率很高）

### 如果题库增长到20题

- **1-10次练习**：**0-10%**
- **11-20次练习**：**10-30%**
- **21-50次练习**：**30-50%**
- **50+次练习**：**50-70%**

### 如果题库增长到50题

- **1-20次练习**：**0-15%**
- **21-50次练习**：**15-30%**
- **50+次练习**：**30-50%**

---

## 🎯 结论

1. **短期练习（<10次）**：重复概率很低（<20%），用户体验良好
2. **中期练习（10-50次）**：重复概率中等（20-50%），可以接受
3. **长期练习（50+次）**：重复概率较高（50-80%），建议增强exclude机制

**总体评价**：当前机制在**短期和中期**表现良好，但**长期练习**时重复概率较高。建议实施增强exclude机制以改善长期用户体验。
