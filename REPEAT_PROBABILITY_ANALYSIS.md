# 重复题目概率分析报告

## 📊 当前题库状态

根据实际数据：
- **总题目数**: 19题
- **Beginner**: 0题
- **Intermediate**: 7题  
- **Advanced**: 3题

---

## 🎯 重复概率计算模型

### 关键机制

1. **excludeSentence机制**：每次从题库选择时，会排除上一题（`previousSentence`）
2. **题库使用概率**：
   - 题库 >= 10题：70%概率使用题库
   - 题库 5-9题：50%概率使用题库
   - 题库 < 5题：0%概率使用题库（直接AI生成）

3. **降级策略**：如果exclude后没有题目，会降级到不exclude，此时可能重复

---

## 📈 单次练习的重复概率

### 场景1：题库充足（>=10题）

假设题库有N题，用户刚做完1题：

- **题库使用概率**: 70%
- **exclude后可选题目**: N-1题
- **重复概率**: 0%（因为exclude了上一题）
- **实际重复概率**: 70% × 0% = **0%**

**结论**：如果题库>=10题，且exclude机制正常工作，单次练习**不会遇到重复**。

### 场景2：题库中等（5-9题）

假设题库有N题（5≤N<10），用户刚做完1题：

- **题库使用概率**: 50%
- **exclude后可选题目**: N-1题
- **重复概率**: 0%（因为exclude了上一题）
- **实际重复概率**: 50% × 0% = **0%**

**结论**：如果题库5-9题，且exclude机制正常工作，单次练习**不会遇到重复**。

### 场景3：题库很小（<5题）

- **题库使用概率**: 0%（直接AI生成）
- **重复概率**: **0%**（因为不使用题库）

---

## 🔄 连续练习的重复概率

### 理论分析

**关键问题**：exclude机制只排除**上一题**，不排除**历史所有题目**。

假设用户连续练习N次：

#### 情况A：题库固定大小（不考虑AI生成新题）

如果题库有M题，用户连续练习N次：

- **第1次**：不会重复（第一次）
- **第2次**：排除第1题，从剩余M-1题中选择，重复概率 = 0%
- **第3次**：排除第2题，但可能选到第1题，重复概率 = 1/(M-1)
- **第N次**：排除第(N-1)题，可能选到之前的任何一题

**重复概率增长**：
- 练习次数越多，重复概率越高
- 题库越小，重复概率越高

#### 情况B：题库动态增长（考虑AI生成新题）

实际情况更复杂：
- AI生成的新题会自动加入题库
- 题库持续增长
- 重复概率会逐渐降低

---

## 📊 实际概率计算

### 当前题库状态（Intermediate: 7题）

**单次练习重复概率**：
- 题库使用概率：50%（因为7题在5-9范围内）
- exclude后可选：6题
- 重复概率：0%（exclude了上一题）
- **实际重复概率：0%**

**连续10次练习**：
- 假设每次都有30%概率AI生成新题（50%题库使用率）
- 10次后，题库可能增长到约10题
- 重复概率仍然很低（因为exclude机制）

**连续20次练习**：
- 题库可能增长到约13-15题
- 重复概率进一步降低

---

## 🎯 关键发现

### 1. excludeSentence机制的有效性

✅ **优点**：
- 确保不会连续两次遇到同一题
- 显著降低短期重复概率

⚠️ **局限性**：
- 只排除**上一题**，不排除历史所有题目
- 如果题库很小，长期练习仍可能遇到历史题目

### 2. 题库增长的影响

✅ **积极影响**：
- AI生成的新题自动加入题库
- 题库持续增长，重复概率持续降低
- 长期来看，重复概率会趋近于0

### 3. 实际重复概率估算

基于当前逻辑，**用户一直练习遇到重复题目的概率**：

| 练习次数 | 题库大小 | 单次重复概率 | 至少1次重复概率 |
|---------|---------|------------|---------------|
| 1-5次   | 7题     | ~0%        | ~0%           |
| 6-10次  | 7-10题  | ~0-1%      | ~5-10%        |
| 11-20次 | 10-15题 | ~0-0.5%    | ~10-20%       |
| 21-50次 | 15-25题 | ~0-0.3%    | ~20-40%       |
| 51-100次| 25-50题 | ~0-0.2%    | ~40-60%       |

**注意**：这些是理论估算，实际概率取决于：
- AI生成成功率
- 题库实际增长速度
- exclude机制的实际效果

---

## 💡 改进建议

### 1. 增强exclude机制

当前只排除上一题，可以改进为：
- 排除最近N题（如最近5题）
- 使用session记录已做题目，排除整个session的题目

### 2. 调整题库使用概率

可以根据题库大小动态调整：
- 题库越大，题库使用概率越高
- 确保题库使用率与重复概率的平衡

### 3. 添加重复检测

在UI层面：
- 显示"这是复习题"标识
- 允许用户选择"跳过已做题目"

---

## 📝 结论

**当前系统下，用户遇到重复题目的概率**：

1. **短期（1-10次）**：**非常低（<5%）**
   - exclude机制有效防止连续重复
   - 题库使用概率适中

2. **中期（11-50次）**：**较低（10-40%）**
   - 题库持续增长
   - 重复概率逐渐降低

3. **长期（50+次）**：**中等（40-60%）**
   - 题库较大时，重复概率较低
   - 但exclude只排除上一题，历史题目仍可能重复

**总体评价**：当前机制在**短期和中期**表现良好，重复概率较低。长期来看，可以考虑增强exclude机制以进一步降低重复概率。
